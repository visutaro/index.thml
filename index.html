<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ÁøíÊÖ£„Éà„É©„ÉÉ„Ç´„Éº</title>
    <link rel="manifest" href="data:application/json;base64,ewogICJuYW1lIjogIuezleaFo+ODiOODqeODg+OCq+ODvCIsCiAgInNob3J0X25hbWUiOiAi57+S5oWjIiwKICAic3RhcnRfdXJsIjogIi4iLAogICJkaXNwbGF5IjogInN0YW5kYWxvbmUiLAogICJiYWNrZ3JvdW5kX2NvbG9yIjogIiMwYTBhMGEiLAogICJ0aGVtZV9jb2xvciI6ICIjZmY2YjZiIgp9">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@700;900&family=Inter:wght@400;600;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        :root {
            --bg: #0a0a0a;
            --surface: #1a1a1a;
            --accent: #ff6b6b;
            --accent-hover: #ff5252;
            --text: #ffffff;
            --text-dim: #888888;
            --success: #51cf66;
            --border: #333333;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            overflow-x: hidden;
            user-select: none;
            -webkit-user-select: none;
        }

        .app-container {
            max-width: 500px;
            margin: 0 auto;
            padding-bottom: 80px;
        }

        .header {
            padding: 20px;
            text-align: center;
            background: linear-gradient(180deg, var(--surface) 0%, transparent 100%);
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(10px);
        }

        .header h1 {
            font-family: 'Orbitron', sans-serif;
            font-size: 32px;
            font-weight: 900;
            background: linear-gradient(135deg, var(--accent) 0%, #ffd93d 100%);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: 2px;
        }

        .tabs {
            display: flex;
            gap: 10px;
            padding: 20px;
            overflow-x: auto;
        }

        .tab {
            flex: 1;
            min-width: 100px;
            padding: 15px;
            background: var(--surface);
            border: 2px solid var(--border);
            border-radius: 15px;
            color: var(--text-dim);
            font-weight: 700;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }

        .tab.active {
            background: var(--accent);
            border-color: var(--accent);
            color: var(--text);
            transform: scale(1.05);
        }

        .content {
            padding: 0 20px;
        }

        .panel {
            display: none;
        }

        .panel.active {
            display: block;
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* 25Tap Game */
        .game-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            padding: 20px;
            background: var(--surface);
            border-radius: 15px;
            border: 2px solid var(--border);
        }

        .info-item {
            text-align: center;
        }

        .info-label {
            font-size: 12px;
            color: var(--text-dim);
            margin-bottom: 5px;
        }

        .info-value {
            font-family: 'Orbitron', sans-serif;
            font-size: 24px;
            font-weight: 900;
            color: var(--accent);
        }

        .game-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        .game-cell {
            aspect-ratio: 1;
            background: var(--surface);
            border: 2px solid var(--border);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Orbitron', sans-serif;
            font-size: 24px;
            font-weight: 900;
            cursor: pointer;
            transition: all 0.2s;
        }

        .game-cell:active {
            transform: scale(0.9);
        }

        .game-cell.found {
            background: var(--success);
            border-color: var(--success);
            animation: pulse 0.3s;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .btn {
            width: 100%;
            padding: 18px;
            background: var(--accent);
            color: var(--text);
            border: none;
            border-radius: 15px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'Inter', sans-serif;
        }

        .btn:active {
            transform: scale(0.95);
            background: var(--accent-hover);
        }

        .btn:disabled {
            background: var(--border);
            cursor: not-allowed;
            opacity: 0.5;
        }

        /* HIIT */
        .video-container {
            position: relative;
            padding-bottom: 56.25%;
            height: 0;
            margin-bottom: 20px;
            border-radius: 15px;
            overflow: hidden;
            background: var(--surface);
        }

        .video-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        .sets-counter {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin: 30px 0;
            padding: 30px;
            background: var(--surface);
            border-radius: 15px;
            border: 2px solid var(--border);
        }

        .sets-btn {
            width: 60px;
            height: 60px;
            background: var(--accent);
            border: none;
            border-radius: 50%;
            color: var(--text);
            font-size: 32px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
        }

        .sets-btn:active {
            transform: scale(0.9);
        }

        .sets-display {
            font-family: 'Orbitron', sans-serif;
            font-size: 48px;
            font-weight: 900;
            color: var(--accent);
            min-width: 80px;
            text-align: center;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-size: 14px;
            font-weight: 600;
            color: var(--text-dim);
        }

        .input-group input {
            width: 100%;
            padding: 15px;
            background: var(--surface);
            border: 2px solid var(--border);
            border-radius: 10px;
            color: var(--text);
            font-size: 16px;
            font-family: 'Inter', sans-serif;
        }

        .input-group input:focus {
            outline: none;
            border-color: var(--accent);
        }

        /* ÁûëÊÉ≥ */
        .timer-display {
            text-align: center;
            margin: 40px 0;
        }

        .timer-time {
            font-family: 'Orbitron', sans-serif;
            font-size: 72px;
            font-weight: 900;
            color: var(--accent);
            margin-bottom: 20px;
        }

        .timer-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
        }

        .timer-presets {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        .preset-btn {
            padding: 15px;
            background: var(--surface);
            border: 2px solid var(--border);
            border-radius: 10px;
            color: var(--text);
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
        }

        .preset-btn:active {
            transform: scale(0.95);
        }

        .notification-toggle {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .toggle-btn {
            flex: 1;
            padding: 15px;
            background: var(--surface);
            border: 2px solid var(--border);
            border-radius: 10px;
            color: var(--text-dim);
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
        }

        .toggle-btn.active {
            background: var(--accent);
            border-color: var(--accent);
            color: var(--text);
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal.active {
            display: flex;
            animation: fadeIn 0.3s;
        }

        .modal-content {
            background: var(--surface);
            border: 2px solid var(--border);
            border-radius: 20px;
            padding: 30px;
            max-width: 400px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-title {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 20px;
            text-align: center;
        }

        .rating-group {
            margin-bottom: 20px;
        }

        .rating-buttons {
            display: flex;
            gap: 8px;
            margin-top: 10px;
        }

        .rating-btn {
            flex: 1;
            padding: 15px;
            background: var(--surface);
            border: 2px solid var(--border);
            border-radius: 10px;
            color: var(--text-dim);
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
        }

        .rating-btn.selected {
            background: var(--accent);
            border-color: var(--accent);
            color: var(--text);
            transform: scale(1.05);
        }

        .modal textarea {
            width: 100%;
            min-height: 80px;
            padding: 15px;
            background: var(--bg);
            border: 2px solid var(--border);
            border-radius: 10px;
            color: var(--text);
            font-size: 16px;
            font-family: 'Inter', sans-serif;
            resize: vertical;
        }

        .modal textarea:focus {
            outline: none;
            border-color: var(--accent);
        }

        .modal-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .result-display {
            text-align: center;
            padding: 20px;
            background: var(--surface);
            border: 2px solid var(--success);
            border-radius: 15px;
            margin-bottom: 20px;
        }

        .result-value {
            font-family: 'Orbitron', sans-serif;
            font-size: 48px;
            font-weight: 900;
            color: var(--success);
            margin-bottom: 10px;
        }

        .result-label {
            font-size: 14px;
            color: var(--text-dim);
        }
    </style>
</head>
<body>
    <div class="app-container">
        <div class="header">
            <h1>TRACKER</h1>
        </div>

        <div class="tabs">
            <div class="tab active" data-tab="25tap">25TAP</div>
            <div class="tab" data-tab="hiit">HIIT</div>
            <div class="tab" data-tab="meditation">ÁûëÊÉ≥</div>
            <div class="tab" data-tab="settings">Ë®≠ÂÆö</div>
        </div>

        <div class="content">
            <!-- 25Tap Panel -->
            <div class="panel active" id="25tap">
                <div class="game-info">
                    <div class="info-item">
                        <div class="info-label">Ê¨°</div>
                        <div class="info-value" id="nextNumber">1</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">„Çø„Ç§„É†</div>
                        <div class="info-value" id="gameTime">0.00</div>
                    </div>
                </div>

                <div class="game-grid" id="gameGrid"></div>

                <button class="btn" id="startGameBtn">„Çπ„Çø„Éº„Éà</button>
            </div>

            <!-- HIIT Panel -->
            <div class="panel" id="hiit">
                <div class="video-container" id="videoContainer">
                    <div style="display: flex; align-items: center; justify-content: center; height: 100%; color: var(--text-dim);">
                        Ë®≠ÂÆö„Åã„ÇâYouTube URL„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ
                    </div>
                </div>

                <div class="sets-counter">
                    <button class="sets-btn" id="setsDown">‚àí</button>
                    <div class="sets-display" id="setsCount">0</div>
                    <button class="sets-btn" id="setsUp">+</button>
                </div>

                <button class="btn" id="completeHiit">ÂÆå‰∫Ü</button>
            </div>

            <!-- ÁûëÊÉ≥ Panel -->
            <div class="panel" id="meditation">
                <div class="timer-display">
                    <div class="timer-time" id="timerDisplay">00:00</div>
                </div>

                <div class="timer-presets">
                    <button class="preset-btn" data-minutes="5">5ÂàÜ</button>
                    <button class="preset-btn" data-minutes="10">10ÂàÜ</button>
                    <button class="preset-btn" data-minutes="15">15ÂàÜ</button>
                    <button class="preset-btn" data-minutes="20">20ÂàÜ</button>
                    <button class="preset-btn" data-minutes="25">25ÂàÜ</button>
                    <button class="preset-btn" data-minutes="30">30ÂàÜ</button>
                </div>

                <div class="notification-toggle">
                    <button class="toggle-btn active" id="soundToggle">üîî Èü≥</button>
                    <button class="toggle-btn" id="vibrateToggle">üì≥ ÊåØÂãï</button>
                </div>

                <div class="timer-controls">
                    <button class="btn" id="startTimer" style="flex: 1;">ÈñãÂßã</button>
                    <button class="btn" id="stopTimer" style="flex: 1; background: var(--border);">ÂÅúÊ≠¢</button>
                </div>
            </div>

            <!-- Ë®≠ÂÆö Panel -->
            <div class="panel" id="settings">
                <div class="input-group">
                    <label>HIITÂãïÁîªURLÔºàYouTube„ÅÆÂÖ±ÊúâURLÔºâ</label>
                    <input type="text" id="hiitUrl" placeholder="https://youtu.be/...">
                </div>
                <button class="btn" id="saveSettings">‰øùÂ≠ò</button>
            </div>
        </div>
    </div>

    <!-- Ë®òÈå≤Modal -->
    <div class="modal" id="recordModal">
        <div class="modal-content">
            <div class="modal-title" id="modalTitle">Ë®òÈå≤„Çí‰øùÂ≠ò</div>
            
            <div class="result-display" id="resultDisplay" style="display: none;">
                <div class="result-value" id="resultValue">--</div>
                <div class="result-label" id="resultLabel">--</div>
            </div>

            <div class="rating-group">
                <label>‰ΩìË™øÔºà1-10Ôºâ</label>
                <div class="rating-buttons" id="conditionRating"></div>
            </div>

            <div class="rating-group" id="moodGroup" style="display: none;">
                <label>ÁûëÊÉ≥Âæå„ÅÆÊ∞óÂàÜÔºà1-5Ôºâ</label>
                <div class="rating-buttons" id="moodRating"></div>
            </div>

            <div class="input-group">
                <label>„É°„É¢Ôºà‰ªªÊÑèÔºâ</label>
                <textarea id="memoText" placeholder="‰ªäÊó•„ÅÆÊ∞ó„Å•„Åç„ÇÑÊÑüÊÉ≥..."></textarea>
            </div>

            <div class="modal-buttons">
                <button class="btn" id="cancelRecord" style="background: var(--border);">„Ç≠„É£„É≥„Çª„É´</button>
                <button class="btn" id="saveRecord">‰øùÂ≠ò</button>
            </div>
        </div>
    </div>

    <script>
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxQc1Ds2hnkpTP8f8s0tuO4vyG8IP98WoGbOXuPOWmeHNbash1_cQSb3zbLML6ROpSZeg/exec';

        // TabÂàá„ÇäÊõø„Åà
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
                
                tab.classList.add('active');
                document.getElementById(tab.dataset.tab).classList.add('active');
            });
        });

        // 25Tap Game
        let gameNumbers = [];
        let currentNumber = 1;
        let startTime = null;
        let timerInterval = null;

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function initGame() {
            gameNumbers = shuffleArray([...Array(25)].map((_, i) => i + 1));
            currentNumber = 1;
            document.getElementById('nextNumber').textContent = currentNumber;
            
            const grid = document.getElementById('gameGrid');
            grid.innerHTML = '';
            
            gameNumbers.forEach(num => {
                const cell = document.createElement('div');
                cell.className = 'game-cell';
                cell.textContent = num;
                cell.addEventListener('click', () => handleCellClick(num, cell));
                grid.appendChild(cell);
            });

            startTime = Date.now();
            timerInterval = setInterval(updateTimer, 10);
        }

        function updateTimer() {
            if (!startTime) return;
            const elapsed = ((Date.now() - startTime) / 1000).toFixed(2);
            document.getElementById('gameTime').textContent = elapsed;
        }

        function handleCellClick(num, cell) {
            if (num === currentNumber) {
                cell.classList.add('found');
                
                if (currentNumber === 25) {
                    clearInterval(timerInterval);
                    const finalTime = ((Date.now() - startTime) / 1000).toFixed(2);
                    showRecordModal('25Tap', finalTime);
                } else {
                    currentNumber++;
                    document.getElementById('nextNumber').textContent = currentNumber;
                }
            }
        }

        document.getElementById('startGameBtn').addEventListener('click', initGame);

        // HIIT
        let hiitSets = 0;

        document.getElementById('setsUp').addEventListener('click', () => {
            hiitSets++;
            document.getElementById('setsCount').textContent = hiitSets;
        });

        document.getElementById('setsDown').addEventListener('click', () => {
            if (hiitSets > 0) {
                hiitSets--;
                document.getElementById('setsCount').textContent = hiitSets;
            }
        });

        document.getElementById('completeHiit').addEventListener('click', () => {
            if (hiitSets > 0) {
                showRecordModal('HIIT', hiitSets);
            } else {
                alert('„Çª„ÉÉ„ÉàÊï∞„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
            }
        });

        // ÁûëÊÉ≥„Çø„Ç§„Éû„Éº
        let meditationTime = 0;
        let meditationInterval = null;
        let meditationStartTime = null;
        let useSound = true;
        let useVibrate = false;

        document.querySelectorAll('.preset-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                meditationTime = parseInt(btn.dataset.minutes) * 60;
                updateTimerDisplay();
            });
        });

        document.getElementById('soundToggle').addEventListener('click', function() {
            useSound = !useSound;
            this.classList.toggle('active');
            if (useSound && useVibrate) {
                useVibrate = false;
                document.getElementById('vibrateToggle').classList.remove('active');
            }
        });

        document.getElementById('vibrateToggle').addEventListener('click', function() {
            useVibrate = !useVibrate;
            this.classList.toggle('active');
            if (useVibrate && useSound) {
                useSound = false;
                document.getElementById('soundToggle').classList.remove('active');
            }
        });

        function updateTimerDisplay() {
            const minutes = Math.floor(meditationTime / 60);
            const seconds = meditationTime % 60;
            document.getElementById('timerDisplay').textContent = 
                `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
        }

        document.getElementById('startTimer').addEventListener('click', () => {
            if (meditationTime > 0 && !meditationInterval) {
                meditationStartTime = Date.now();
                meditationInterval = setInterval(() => {
                    meditationTime--;
                    updateTimerDisplay();
                    
                    if (meditationTime <= 0) {
                        clearInterval(meditationInterval);
                        meditationInterval = null;
                        notifyComplete();
                        const duration = Math.round((Date.now() - meditationStartTime) / 1000 / 60);
                        showRecordModal('ÁûëÊÉ≥', duration);
                    }
                }, 1000);
            }
        });

        document.getElementById('stopTimer').addEventListener('click', () => {
            if (meditationInterval) {
                clearInterval(meditationInterval);
                meditationInterval = null;
                if (meditationStartTime) {
                    const duration = Math.round((Date.now() - meditationStartTime) / 1000 / 60);
                    if (duration > 0) {
                        showRecordModal('ÁûëÊÉ≥', duration);
                    }
                }
            }
        });

        function notifyComplete() {
            if (useSound) {
                // „Éì„Éº„ÉóÈü≥„Çí3ÂõûÈ≥¥„Çâ„Åô
                const context = new (window.AudioContext || window.webkitAudioContext)();
                for (let i = 0; i < 3; i++) {
                    setTimeout(() => {
                        const oscillator = context.createOscillator();
                        const gainNode = context.createGain();
                        oscillator.connect(gainNode);
                        gainNode.connect(context.destination);
                        oscillator.frequency.value = 800;
                        gainNode.gain.setValueAtTime(0.3, context.currentTime);
                        oscillator.start();
                        oscillator.stop(context.currentTime + 0.2);
                    }, i * 300);
                }
            }
            
            if (useVibrate && 'vibrate' in navigator) {
                navigator.vibrate([200, 100, 200, 100, 200]);
            }
        }

        // Ë®≠ÂÆö
        document.getElementById('saveSettings').addEventListener('click', () => {
            const url = document.getElementById('hiitUrl').value;
            if (url) {
                localStorage.setItem('hiitUrl', url);
                loadHiitVideo();
                alert('‰øùÂ≠ò„Åó„Åæ„Åó„Åü');
            }
        });

        function loadHiitVideo() {
            const url = localStorage.getItem('hiitUrl');
            if (url) {
                document.getElementById('hiitUrl').value = url;
                const videoId = extractYouTubeId(url);
                if (videoId) {
                    document.getElementById('videoContainer').innerHTML = 
                        `<iframe src="https://www.youtube.com/embed/${videoId}" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>`;
                }
            }
        }

        function extractYouTubeId(url) {
            const regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/;
            const match = url.match(regExp);
            return (match && match[2].length === 11) ? match[2] : null;
        }

        // Ë®òÈå≤Modal
        let currentActivity = null;
        let currentResult = null;

        function showRecordModal(activity, result) {
            currentActivity = activity;
            currentResult = result;
            
            document.getElementById('modalTitle').textContent = `${activity}„ÅÆË®òÈå≤`;
            
            // ÁµêÊûúË°®Á§∫
            const resultDisplay = document.getElementById('resultDisplay');
            const resultValue = document.getElementById('resultValue');
            const resultLabel = document.getElementById('resultLabel');
            
            resultDisplay.style.display = 'block';
            
            if (activity === '25Tap') {
                resultValue.textContent = `${result}Áßí`;
                resultLabel.textContent = '„ÇØ„É™„Ç¢„Çø„Ç§„É†';
            } else if (activity === 'HIIT') {
                resultValue.textContent = `${result}„Çª„ÉÉ„Éà`;
                resultLabel.textContent = 'ÂÆå‰∫Ü';
            } else if (activity === 'ÁûëÊÉ≥') {
                resultValue.textContent = `${result}ÂàÜ`;
                resultLabel.textContent = 'ÁûëÊÉ≥ÊôÇÈñì';
            }
            
            // ÁûëÊÉ≥„ÅÆÂ†¥Âêà„ÅÆ„ÅøÊ∞óÂàÜË©ï‰æ°„ÇíË°®Á§∫
            const moodGroup = document.getElementById('moodGroup');
            if (activity === 'ÁûëÊÉ≥') {
                moodGroup.style.display = 'block';
                initRatingButtons('moodRating', 5);
            } else {
                moodGroup.style.display = 'none';
            }
            
            initRatingButtons('conditionRating', 10);
            document.getElementById('memoText').value = '';
            document.getElementById('recordModal').classList.add('active');
        }

        function initRatingButtons(containerId, max) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            for (let i = 1; i <= max; i++) {
                const btn = document.createElement('button');
                btn.className = 'rating-btn';
                btn.textContent = i;
                btn.addEventListener('click', function() {
                    container.querySelectorAll('.rating-btn').forEach(b => b.classList.remove('selected'));
                    this.classList.add('selected');
                });
                container.appendChild(btn);
            }
        }

        document.getElementById('cancelRecord').addEventListener('click', () => {
            document.getElementById('recordModal').classList.remove('active');
        });

        document.getElementById('saveRecord').addEventListener('click', async () => {
            const condition = document.querySelector('#conditionRating .rating-btn.selected')?.textContent;
            
            if (!condition) {
                alert('‰ΩìË™ø„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                return;
            }
            
            const now = new Date();
            const date = now.toLocaleDateString('ja-JP');
            const time = now.toLocaleTimeString('ja-JP', { hour: '2-digit', minute: '2-digit' });
            const memo = document.getElementById('memoText').value;
            
            let data = {
                date: date,
                time: time,
                condition: condition,
                memo: memo
            };
            
            if (currentActivity === '25Tap') {
                data.type = '25Tap';
                data.score = currentResult;
            } else if (currentActivity === 'HIIT') {
                data.type = 'HIIT';
                data.sets = currentResult;
            } else if (currentActivity === 'ÁûëÊÉ≥') {
                const mood = document.querySelector('#moodRating .rating-btn.selected')?.textContent;
                if (!mood) {
                    alert('ÁûëÊÉ≥Âæå„ÅÆÊ∞óÂàÜ„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                    return;
                }
                data.type = 'ÁûëÊÉ≥';
                data.mood = mood;
            }
            
            try {
                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });
                
                alert('Ë®òÈå≤„Çí‰øùÂ≠ò„Åó„Åæ„Åó„ÅüÔºÅ');
                document.getElementById('recordModal').classList.remove('active');
                
                // „É™„Çª„ÉÉ„Éà
                if (currentActivity === 'HIIT') {
                    hiitSets = 0;
                    document.getElementById('setsCount').textContent = 0;
                } else if (currentActivity === 'ÁûëÊÉ≥') {
                    meditationTime = 0;
                    updateTimerDisplay();
                }
            } catch (error) {
                alert('Ë®òÈå≤„ÅÆ‰øùÂ≠ò„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
                console.error(error);
            }
        });

        // ÂàùÊúüÂåñ
        loadHiitVideo();
    </script>
</body>
</html>